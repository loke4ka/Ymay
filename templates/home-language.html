<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Homepage</title>
    <link rel="stylesheet" href="{% static 'Ymay/style.css' %}"/>
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@200;300;400;500;600;700&display=swap"
          rel="stylesheet"/>
    <style>

        .video-container {
            border-radius: 10px;
        }

        .btn-check {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 18px;
            width: 360px;
            height: 16px;
            border-radius: 100px;
            text-decoration: none;
            font-weight: 600;
            margin: 10px auto 0;
        }

    </style>
</head>
<body>
<div class="main">
    <div class="container">
        <div class="content">
            <!-- homepage navbar  -->
            <section class="homepage-navbar-sec">
                <div class="homepage-navbar">
                    <!-- language-flag -->
                    <div class="language-flag item">
                        <div class="img-container">
                            <img src="{% static 'Ymay/images/homepage-icons/navbar-icons/usa-flag.png' %}" alt=""
                                 srcset=""/>
                        </div>
                        <p class="nav-text">EN</p>
                    </div>
                    <!-- fire points  -->
                    <div class="fire-points item">
                        <img src="{% static 'Ymay/images/homepage-icons/navbar-icons/fire-icon.png' %}" alt=""
                             srcset=""/>
                        <p class="nav-text">4</p>
                    </div>
                    <!-- diamond-points -->
                    <div class="diamond-points item">
                        <img src="{% static 'Ymay/images/homepage-icons/navbar-icons/points-icon.png' %}" alt=""
                             srcset=""/>
                        <p class="nav-text">957</p>
                    </div>
                    <!-- stars  -->
                    <div class="stars item">
                        <img src="{% static 'Ymay/images/homepage-icons/navbar-icons/star-icon.png' %}" alt=""
                             srcset=""/>
                        <p class="nav-text"></p>
                    </div>
                </div>
                <div class="expanded-navbar">
                    <!-- language expanded options -->
                    <div class="expanded-lang-flag item">
                        <div class="expanded-inner"></div>
                        <img class="expand-arrow"
                             src="{% static 'Ymay/images/homepage-icons/navbar-icons/expand-arrow.png' %}" alt=""
                             srcset=""/>
                        <div class="lang-opts expanded-container">
                            <!-- language option -->
                            <div class="exp-lang-opt">
                                <img class="opt-img"
                                     src="{% static 'Ymay/images/homepage-icons/navbar-icons/usa-flag.png' %}" alt=""
                                     srcset=""/>
                                <p class="opt-title">English</p>
                            </div>
                            <!-- language option -->
                            <div class="exp-lang-opt">
                                <img class="opt-img"
                                     src="{% static 'Ymay/images/homepage-icons/navbar-icons/kazakh-flag.png' %}" alt=""
                                     srcset=""/>
                                <p class="opt-title">Kazakh</p>
                            </div>
                            <!-- language option -->
                            <div class="exp-lang-opt">
                                <img class="opt-img"
                                     src="{% static 'Ymay/images/homepage-icons/navbar-icons/plus-lang.png' %}" alt=""
                                     srcset=""/>
                                <p class="opt-title">Add</p>
                            </div>
                        </div>
                    </div>
                    <div class="expanded-firepoints">
                        <div class="expanded-inner"></div>
                        <img class="expand-arrow"
                             src="{% static 'Ymay/images/homepage-icons/navbar-icons/expand-arrow.png' %}" alt=""
                             srcset=""/>
                        <div class="firepoint-opts expanded-container">
                            <!-- challenges days -->
                            <div class="challenges-day">
                                <div class="inner">
                                    <p class="title">Challenges (day)</p>
                                    <p class="days">4 / 14</p>
                                </div>
                                <div class="progress">
                                    <progress id="challenges-day" value="4" max="14"></progress>
                                </div>
                            </div>
                            <!-- challenge done and reamining -->
                            <div class="done-remaining">
                                <div class="challenge-done item">
                                    <img src="{% static 'Ymay/images/homepage-icons/navbar-icons/challenge-fire-icon.png' %}"
                                         alt=""/>
                                    <p class="title">4 days</p>
                                    <p class="sub-title">challenge done</p>
                                </div>
                                <div class="challenge-remaining item">
                                    <img src="{% static 'Ymay/images/homepage-icons/navbar-icons/challenge-calender-icon.png' %}"
                                         alt=""/>
                                    <p class="title">10 days</p>
                                    <p class="sub-title">remaining</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- homepage main contents  -->
            <form method="POST" action="{% url 'home_language' %}" name="letter-form">
                {% csrf_token %}
                <input type="hidden" name="letter" id="letter-input" value="{{ letter }}">
                <!-- Добавлено скрытое поле для хранения выбранной буквы || -->
                <section class="home-lang-main-contents">
                    <!-- home langauge header  -->
                    <div class="home-lang-header">
                        <a href="{% url 'homepage' %}"> <img src="{% static 'Ymay/images/back-arrow.png' %}" alt=""
                                                             srcset=""/></a>
                        <p class="title">Gallery</p>
                    </div>
                    <div class="letters-content">
                        <a class="letter" name="А" href="javascript:submitForm('А')" data-letter="А">А</a>
                        <a class="letter" name="Ә" href="javascript:submitForm('Ә')" data-letter="Ә">Ә</a>
                        <a class="letter" name="Б" data-letter="Б" href="javascript:submitForm('Б')">Б</a>
                        <a class="letter" name="В" href="javascript:submitForm('В')" data-letter="В">В</a>
                        <a class="letter" name="Г" href="javascript:submitForm('Г')" data-letter="Г">Г</a>
                        <a class="letter" name="Ғ" href="javascript:submitForm('Ғ')" data-letter="Ғ">Ғ</a>
                        <a class="letter" name="Д" href="javascript:submitForm('Д')" data-letter="Д">Д</a>
                        <a class="letter" name="Е" href="javascript:submitForm('Е')" data-letter="Е">Е</a>
                        <a class="letter" name="Ё" href="javascript:submitForm('Ё')" data-letter="Ё">Ё</a>
                        <a class="letter" name="Ж" href="javascript:submitForm('Ж')" data-letter="Ж">Ж</a>
                        <a class="letter" name="З" href="javascript:submitForm('З')" data-letter="З">З</a>
                        <a class="letter" name="И" href="javascript:submitForm('И')" data-letter="И">И</a>
                        <a class="letter" name="Й" href="javascript:submitForm('Й')" data-letter="Й">Й</a>
                        <a class="letter" name="К" href="javascript:submitForm('К')" data-letter="К">К</a>
                        <a class="letter" name="Қ" href="javascript:submitForm('Қ')" data-letter="Қ">Қ</a>
                        <a class="letter" name="Л" href="javascript:submitForm('Л')" data-letter="Л">Л</a>
                        <a class="letter" name="М" href="javascript:submitForm('М')" data-letter="М">М</a>
                        <a class="letter" name="Н" href="javascript:submitForm('Н')" data-letter="Н">Н</a>
                        <a class="letter" name="Ң" href="javascript:submitForm('Ң')" data-letter="Ң">Ң</a>
                        <a class="letter" name="О" href="javascript:submitForm('О')" data-letter="О">О</a>
                        <a class="letter" name="Ө" href="javascript:submitForm('Ө')" data-letter="Ө">Ө</a>
                        <a class="letter" name="П" href="javascript:submitForm('П')" data-letter="П">П</a>
                        <a class="letter" name="Р" href="javascript:submitForm('Р')" data-letter="Р">Р</a>
                        <a class="letter" name="С" href="javascript:submitForm('С')" data-letter="С">С</a>
                        <a class="letter" name="Т" href="javascript:submitForm('Т')" data-letter="Т">Т</a>
                        <a class="letter" name="У" href="javascript:submitForm('У')" data-letter="У">У</a>
                        <a class="letter" name="Ұ" href="javascript:submitForm('Ұ')" data-letter="Ұ">Ұ</a>
                        <a class="letter" name="Ү" href="javascript:submitForm('Ү')" data-letter="Ү">Ү</a>
                        <a class="letter" data-letter="Ф" href="javascript:submitForm('Ф')">Ф</a>
                        <a class="letter" data-letter="Х" href="javascript:submitForm('Х')">Х</a>
                        <a class="letter" data-letter="Һ" href="javascript:submitForm('Һ')">Һ</a>
                        <a class="letter" data-letter="Ц" href="javascript:submitForm('Ц')">Ц</a>
                        <a class="letter" data-letter="Ч" href="javascript:submitForm('Ч')">Ч</a>
                        <a class="letter" data-letter="Ш" href="javascript:submitForm('Ш')">Ш</a>
                        <a class="letter" data-letter="Щ" href="javascript:submitForm('Щ')">Щ</a>
                        <a class="letter" data-letter="Ъ" href="javascript:submitForm('Ъ')">Ъ</a>
                        <a class="letter" data-letter="Ы" href="javascript:submitForm('Ы')">Ы</a>
                        <a class="letter" data-letter="I" href="javascript:submitForm('I')">I</a>
                        <a class="letter" data-letter="Ь" href="javascript:submitForm('Ь')">Ь</a>
                        <a class="letter" data-letter="Э" href="javascript:submitForm('Э')">Э</a>
                        <a class="letter" data-letter="Ю" href="javascript:submitForm('Ю')">Ю</a>
                        <a class="letter" data-letter="Я" href="javascript:submitForm('Я')">Я</a>

                    </div>
                    <div class=" sel-letter-container">
                        <p class="sel-letter">{{ letter }}</p>
                    </div>
                    <!-- video section  -->
                    {% if video_url %}
                        <div class="video-container">
                            <div class="embed-responsive embed-responsive-16by9">
                                <iframe src="{{ video_url }}" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                        <style>
                            .video-container {
                                margin-top: 20px;
                            }

                            .embed-responsive-16by9 iframe {
                                width: 390px;
                                height: 292px;
                                border-radius: 39px;
                                overflow: hidden;
                            }
                        </style>
                    {% endif %}



                    <div class="learn-sign">
                        <span class="btn">Learn this sign</span>
                    </div>
                    <!-- Camera section  -->
                    <form id="letterForm">
                        {% csrf_token %}
                        <input type="hidden" id="selectedLetter" name="selectedLetter" value="{{ letter }}">
                    </form>

                    <div class="camera-section">
                        <p class="camera-pre">Your camera preview</p>
                        <div class="video-container">
                            <video autoplay="true" id="videoCapture"></video>

                        </div>

                        <button type="button" class="btn-check" onclick="checkGesture()">Check Gesture</button>
                        <p class="accuracy">Accuracy: <span id="accuracyScore"></span>%</p>
                    </div>


                </section>
            </form>
            <!-- footer  -->
            <section class="homepage-footer">
                <div class="home item">
                    <img src="{% static 'Ymay/images/homepage-icons/footer-icons/home.png' %}" alt="" srcset=""/>
                    <a href="{% url 'homepage' %}"><p class="footer-text">Home</p></a>
                </div>
                <div class="leaderboard item">
                    <img src="{% static 'Ymay/images/homepage-icons/footer-icons/leaderboard.png' %}" alt=""
                         srcset=""/>
                    <p class="footer-text">leaderboard</p>
                </div>
                <div class="gallery item">
                    <img src="{% static 'Ymay/images/homepage-icons/footer-icons/gallery-fill.png' %}" alt=""
                         srcset=""/>
                    <a href="{% url 'home_language' %}"><p class="footer-text">Gallery</p></a>
                </div>
                <div class="premium item">
                    <img src="{% static 'Ymay/images/homepage-icons/footer-icons/premium.png' %}" alt="" srcset=""/>
                    <a href="{% url 'premium_go' %}"><p class="footer-text">Premium</p></a>
                </div>
                <div class="account item">
                    <img src="{% static 'Ymay/images/homepage-icons/footer-icons/account.png' %}" alt="" srcset=""/>
                    <a href="{% url 'account_page' %}"><p class="footer-text">Account</p></a>
                </div>
            </section>

        </div>
    </div>
</div>
</body>
<script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% csrf_token %}

<script>
    var learnSign = document.querySelector(".learn-sign");
    var cameraPreview = document.querySelector(".camera-section");
    var video = document.querySelector("#videoCapture");

    learnSign.addEventListener("click", function () {
        if (navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({video: true})
                .then(function (stream) {
                    video.srcObject = stream;
                })
                .catch(function (error) {
                    console.log("Something went wrong:", error);
                });
        }
        cameraPreview.classList.add("show");
    });

    function captureGesture() {
        var canvas = document.createElement("canvas");
        var context = canvas.getContext("2d");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        return canvas.toDataURL("image/png");
    }

    function checkGesture() {
        var image = captureGesture();
        var selectedLetter = document.getElementById("selectedLetter").value;

        // console.log("Captured image:", image); // Отладочное сообщение

        fetch("/predict_gesture", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": getCookie("csrftoken")
            },
            body: JSON.stringify({image: image, selectedLetter: selectedLetter})
        })
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
                var accuracyScore = parseFloat(data.accuracy).toFixed(2);
                document.getElementById("accuracyScore").textContent = accuracyScore;
            })
            .catch(function (error) {
                console.log("Error:", error);
            });
    }


    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
            const cookies = document.cookie.split(";");
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === name + "=") {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }


</script>


<script>
    // Добавлено JS-функция для отправки формы
    function submitForm(letter) {
        document.getElementById('letter-input').value = letter;
        document.forms['letter-form'].submit();
    }
</script>

<script>
    var language_flag = document.getElementsByClassName("language-flag")[0];
    var fire_points = document.getElementsByClassName("fire-points")[0];
    var expanded_lang_flag = document.getElementsByClassName("expanded-lang-flag")[0];
    var expanded_firepoints = document.getElementsByClassName("expanded-firepoints")[0];
    language_flag.addEventListener("click", function () {
        expanded_lang_flag.classList.add("show");
        expanded_firepoints.classList.remove("show");
    });
    fire_points.addEventListener("click", function () {
        expanded_lang_flag.classList.remove("show");
        expanded_firepoints.classList.add("show");
    });
</script>
<script>
    // Get all elements with the class
    const letter = document.querySelectorAll(".letter");
    const sel_letter = document.getElementsByClassName("sel-letter")[0];
    const selectedLetter = "{{ letter }}"; // Получаем значение буквы из сервера

    // Loop through each element and add an event listener to it
    letter.forEach((element) => {
        element.addEventListener("click", function () {
            // Loop through all elements and remove class from non-clicked elements
            letter.forEach((nonClickedElement) => {
                if (nonClickedElement !== this) {
                    nonClickedElement.classList.remove("letter-bg");
                } else {
                    // Add the class of the clicked element
                    this.classList.add("letter-bg");
                    sel_letter.innerHTML = this.innerHTML;
                }
            });
        });

        // Set initial background color based on the selected letter
        if (element.innerHTML === selectedLetter) {
            element.classList.add("letter-bg");
            sel_letter.innerHTML = selectedLetter;
        }
    });

</script>


</html>
